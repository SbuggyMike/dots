<!-- SC_OFF --><div class="md"><p>A new scaling driver has been added with kernel 6.3 that promises even more efficiency compared to the previous AMD P-State scaling driver introduced back with kernel 5.17.</p> <p><em>Note: I believe your CPU must be &gt;= Zen 2 (not Zen 1, or Zen +) to support both the original amd_pstate scaling driver, and the new amd_pstate_epp scaling driver. You also have to have CPPC support enabled in your BIOS.</em></p> <p>The Arch Wiki hasn&#39;t yet been updated re: the new <code>amd_pstate_epp</code> scaling driver, and still includes instructions for the original <code>amd_pstate</code> scaling driver. To leverage either scaling drivers you need to add a kernel parameter:</p> <p>For the original <code>amd_pstate</code> scaling driver add <code>amd_pstate=passive</code> as a kernel parameter to your boot loader, e.g.</p> <pre><code>options initrd=initramfs-linux.img root=UUID=e6e347e4-7380-4ce6-aa35-f145a84bee29 rw amd_pstate=passive </code></pre> <p>For the new <code>amd_pstate_epp</code> driver add <code>amd_pstate=active</code> as a kernel parameter to your boot loader, e.g.</p> <pre><code>options initrd=initramfs-linux.img root=UUID=e6e347e4-7380-4ce6-aa35-f145a84bee29 rw amd_pstate=active </code></pre> <p>Please note that the scaling driver is <em>different</em> than the CPU governor (e.g. <code>powersave</code>, <code>performance</code>, <code>ondemand</code>, <code>schedulutil</code>, etc.). IMHO, the easiest way to set CPU governor, is to install <code>cpupower</code>, enable the <code>cpupower</code> systemd service, and edit the <code>/etc/default/cpupower</code> file, but there are many ways to do this!</p> <p>The new <code>amd_pstate_epp</code> scaling driver adds another variable called a &quot;Energy Performance Preference&quot; hint (this is what EPP stands for!). This can be set via sysfs. There are two main files that control this:</p> <ul> <li><code>/sys/devices/system/cpu/cpu[N]/cpufreq/energy_performance_preference</code>: the current EPP hint for the CPU core in question.</li> <li><code>/sys/devices/system/cpu/cpu[N]/cpufreq/energy_performance_available_preferences</code>: the available EPP hints for the CPU core in question.</li> </ul> <p>This means that you can now combine a CPU governor and an EPP hint to fine tune the performance of your CPU.</p> <p>To see you current scaling driver AND governor run <code>cpupower frequency-info</code>, here is the output from my machine:</p> <pre><code>robert@devone ~&gt; cpupower frequency-info analyzing CPU 3: driver: amd_pstate_epp CPUs which run at the same hardware frequency: 3 CPUs which need to have their frequency coordinated by software: 3 maximum transition latency: Cannot determine or is not supported. hardware limits: 400 MHz - 4.51 GHz available cpufreq governors: performance powersave current policy: frequency should be within 400 MHz and 4.51 GHz. The governor &quot;powersave&quot; may decide which speed to use within this range. current CPU frequency: Unable to call hardware current CPU frequency: 400 MHz (asserted by call to kernel) boost state support: Supported: yes Active: no </code></pre> <p>You can see I&#39;m running the <code>amd_pstate_epp</code> scaling driver, and my CPU governor is set to <code>powersave</code>.</p> <p>To see your current EPP hints (note <code>*</code> = all CPU cores):</p> <pre><code>robert@devone ~&gt; cat /sys/devices/system/cpu/cpu*/cpufreq/energy_performance_preference balance_performance balance_performance balance_performance balance_performance balance_performance balance_performance balance_performance balance_performance balance_performance balance_performance balance_performance balance_performance balance_performance balance_performance balance_performance balance_performance </code></pre> <p>To see the available EPP hints (should be the same for all cores):</p> <pre><code>robert@devone ~&gt; cat /sys/devices/system/cpu/cpu0/cpufreq/energy_performance_available_preferences default performance balance_performance balance_power power </code></pre> <p>You can mix and match governors with EPP hints. For me the default after I enabled <code>amd_pstate_epp</code> was governor = <code>powersave</code> and EPP hint = <code>performance</code>. Phoronix has an excellent breakdown of all the combinations of governors + EPP hints (referenced in the resources section at the end of this post).</p> <p>To set the EPP hint across all your cores (e.g. setting EPP to <code>&quot;balance_performance&quot;</code>):</p> <pre><code>robert@devone ~&gt; echo &quot;balance_performance&quot; | sudo tee /sys/devices/system/cpu/cpu*/cpufreq/energy_performance_preference balance_performance </code></pre> <p>I hope this helps folks with modern AMD CPUs get the best possible performance and efficiency out of their systems!</p> <p>Resources:</p> <ul> <li>Benchmarks for server using AMD P-State EPP: <a href="https://www.phoronix.com/review/linux-63-amd-epyc-epp">https://www.phoronix.com/review/linux-63-amd-epyc-epp</a></li> <li>Benchmarks for Ryzen mobile system using AMD P-State EPP: <a href="https://www.phoronix.com/review/amd-pstate-epp-ryzen-mobile">https://www.phoronix.com/review/amd-pstate-epp-ryzen-mobile</a></li> <li>Arch Wiki page on CPU Scaling: <a href="https://wiki.archlinux.org/title/CPU_frequency_scaling">https://wiki.archlinux.org/title/CPU_frequency_scaling</a></li> <li>Kernel.org documentation on new AMD P-State driver: <a href="https://www.kernel.org/doc/html/latest/admin-guide/pm/amd-pstate.html">https://www.kernel.org/doc/html/latest/admin-guide/pm/amd-pstate.html</a></li> </ul> <p>Edit: some minor fixes and improvements, thanks to everybody in the comments section!</p> </div><!-- SC_ON --> &#32; submitted by &#32; <a href="https://www.reddit.com/user/rstrube"> /u/rstrube </a> <br/> <span><a href="https://www.reddit.com/r/archlinux/comments/1381g2g/amd_pstate_epp_scaling_driver_available_with/">[link]</a></span> &#32; <span><a href="https://www.reddit.com/r/archlinux/comments/1381g2g/amd_pstate_epp_scaling_driver_available_with/">[comments]</a></span>