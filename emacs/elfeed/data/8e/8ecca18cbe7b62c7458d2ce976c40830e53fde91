<h2 id="the-intro">The intro</h2>
<p>Every Emacs user that I know changes the hell out of the look and feel of their UI. I am no different here.</p>
<p>The following is a list of the function, that use in my module <a href="https://gitlab.com/aimebertrand/dotemacs/-/blob/main/libraries/timu-ui.el">timu-ui.el</a>.</p>
<p>Of course feel free to browse my <a href="https://gitlab.com/aimebertrand/dotemacs">.emacs.d</a> for context ;).</p>
<p align="center"><img src="https://gitlab.com/aimebertrand/timu-caribbean-theme/-/raw/main/img/timu-caribbean.png" width="100%" /></p>
<h2 id="the-functions">The functions</h2>
<h3 id="timu-ui-with-face">timu-ui-with-face</h3>
<p>A very simple function to propertize a string with face property lists similar to <code>set-face-attribute</code>.</p>
<div class="highlight"><pre tabindex="0"><code class="language-emacs-lisp"><span style="display: flex;"><span><span style="color: #eceff4;">(</span><span style="color: #81a1c1;">defun</span> timu-ui-with-face <span style="color: #eceff4;">(</span>str <span style="color: #81a1c1;">&amp;rest</span> face-plist<span style="color: #eceff4;">)</span>
</span></span><span style="display: flex;"><span>  <span style="color: #a3be8c;">"Propertize STR with FACE-PLIST."</span>
</span></span><span style="display: flex;"><span>  <span style="color: #eceff4;">(</span><span style="color: #88c0d0;">propertize</span> str <span style="color: #a3be8c;">'face</span> face-plist<span style="color: #eceff4;">))</span>
</span></span></code></pre></div><p>Example from my eshell prompt customization:</p>
<div class="highlight"><pre tabindex="0"><code class="language-emacs-lisp"><span style="display: flex;"><span><span style="color: #eceff4;">(</span>timu-ui-with-face <span style="color: #a3be8c;">"$"</span> <span style="color: #81a1c1;">:inherit</span> font-lock-preprocessor-face<span style="color: #eceff4;">)</span>
</span></span></code></pre></div><h3 id="timu-ui-load-theme">timu-ui-load-theme</h3>
<p>Emacs has an interactive function to load a theme, <code>load-theme</code>. However in my experience, some face attributes of the last active theme <code>custom-enabled-themes</code> remain visible, depending on the themes. I don’t like it.</p>
<p>This function does remedy the issue by first disabling the last enabled theme.</p>
<div class="highlight"><pre tabindex="0"><code class="language-emacs-lisp"><span style="display: flex;"><span><span style="color: #eceff4;">(</span><span style="color: #81a1c1;">defun</span> timu-ui-load-theme <span style="color: #eceff4;">()</span>
</span></span><span style="display: flex;"><span>  <span style="color: #a3be8c;">"</span><span style="color: #a3be8c;">`load-theme'</span><span style="color: #a3be8c;"> without confirmation and with completion.
</span></span></span><span style="display: flex;"><span><span style="color: #a3be8c;">Disables the </span><span style="color: #a3be8c;">`custom-enabled-themes'</span><span style="color: #a3be8c;"> first to start with a blank canvas."</span>
</span></span><span style="display: flex;"><span>  <span style="color: #eceff4;">(</span><span style="color: #81a1c1;">interactive</span><span style="color: #eceff4;">)</span>
</span></span><span style="display: flex;"><span>  <span style="color: #eceff4;">(</span><span style="color: #81a1c1;">let</span> <span style="color: #eceff4;">((</span>next-theme
</span></span><span style="display: flex;"><span>         <span style="color: #eceff4;">(</span><span style="color: #88c0d0;">completing-read</span> <span style="color: #a3be8c;">"Load custom theme: "</span>
</span></span><span style="display: flex;"><span>                                  <span style="color: #eceff4;">(</span>custom-available-themes<span style="color: #eceff4;">))))</span>
</span></span><span style="display: flex;"><span>    <span style="color: #eceff4;">(</span><span style="color: #88c0d0;">mapc</span> <span style="color: #88c0d0;">#'</span>disable-theme custom-enabled-themes<span style="color: #eceff4;">)</span>
</span></span><span style="display: flex;"><span>    <span style="color: #eceff4;">(</span>load-theme <span style="color: #eceff4;">(</span><span style="color: #88c0d0;">intern</span> next-theme<span style="color: #eceff4;">)</span> <span style="color: #8fbcbb;">t</span><span style="color: #eceff4;">)))</span>
</span></span></code></pre></div><h3 id="timu-ui-flash-mode-line">timu-ui-flash-mode-line</h3>
<p>Remember the bell that goes of on when an “exception” occurs? Annoying right? You can of course set the variable <code>visible-bell</code> to <code>t</code> to flash the frame instead. However I find even that to be vexing.</p>
<p>This function makes just the modeline flash, …</p>
<div class="highlight"><pre tabindex="0"><code class="language-emacs-lisp"><span style="display: flex;"><span><span style="color: #eceff4;">(</span><span style="color: #81a1c1;">defun</span> timu-ui-flash-mode-line <span style="color: #eceff4;">()</span>
</span></span><span style="display: flex;"><span>  <span style="color: #a3be8c;">"Flash the modeline on error or warning instead of the bell."</span>
</span></span><span style="display: flex;"><span>  <span style="color: #eceff4;">(</span>invert-face <span style="color: #a3be8c;">'mode-line</span><span style="color: #eceff4;">)</span>
</span></span><span style="display: flex;"><span>  <span style="color: #eceff4;">(</span>run-with-timer <span style="color: #b48ead;">0.1</span> <span style="color: #8fbcbb;">nil</span> <span style="color: #88c0d0;">#'</span>invert-face <span style="color: #a3be8c;">'mode-line</span><span style="color: #eceff4;">))</span>
</span></span></code></pre></div><p>… when set as:</p>
<div class="highlight"><pre tabindex="0"><code class="language-sh"><span style="display: flex;"><span><span style="color: #81a1c1;">(</span>customize-set-variable <span style="color: #a3be8c;">'ring-bell-function '</span>timu-ui-flash-mode-line<span style="color: #81a1c1;">)</span>
</span></span></code></pre></div><h3 id="just-for-macos">Just for macOS</h3>
<p>I use the either <a href="https://github.com/railwaycat/homebrew-emacsmacport">emacs-mac</a> or the <a href="https://github.com/d12frosted/homebrew-emacs-plus">emacs-plus</a> port of Emacs. These are ports of Emacs, that are better adapted to macOS. These bring different facilities to automatically switch to dark or light mode with the OS. Hence the following functions.</p>
<p>Emacs uses the variable <code>ns-system-appearance-change-functions</code> (emacs-plus) or the hook <code>mac-effective-appearance-change-hook</code> (emacs-mac) respectively. These are keep track with the macOS state to run the hook/function.</p>
<p align="center"><img src="https://gitlab.com/aimebertrand/timu-macos-theme/-/raw/main/img/timu-macos-theme-darker-1.png" width="100%" /></p>
<h4 id="timu-ui-theme-hook">timu-ui-theme-hook</h4>
<p>The hook that gets automatically applied on the change to either dark or light mode in macOS.</p>
<div class="highlight"><pre tabindex="0"><code class="language-emacs-lisp"><span style="display: flex;"><span>   <span style="color: #eceff4;">(</span><span style="color: #81a1c1;">defun</span> timu-ui-theme-hook <span style="color: #eceff4;">(</span><span style="color: #81a1c1;">&amp;optional</span> appearance<span style="color: #eceff4;">)</span>
</span></span><span style="display: flex;"><span>     <span style="color: #a3be8c;">"Hook to change the theme to light or dark.
</span></span></span><span style="display: flex;"><span><span style="color: #a3be8c;">
</span></span></span><span style="display: flex;"><span><span style="color: #a3be8c;">Check the systems APPEARANCE in </span><span style="color: #a3be8c;">`ns-system-appearance'</span><span style="color: #a3be8c;">.
</span></span></span><span style="display: flex;"><span><span style="color: #a3be8c;">Or get by getting the APPEARANCE value of (</span><span style="color: #a3be8c;">`mac-application-state'</span><span style="color: #a3be8c;">).
</span></span></span><span style="display: flex;"><span><span style="color: #a3be8c;">
</span></span></span><span style="display: flex;"><span><span style="color: #a3be8c;">Set the variable </span><span style="color: #a3be8c;">`timu-macos-flavour'</span><span style="color: #a3be8c;"> to \"light\" or \"dark\" accordingly.
</span></span></span><span style="display: flex;"><span><span style="color: #a3be8c;">This is for the case the </span><span style="color: #a3be8c;">`timu-macos-theme'</span><span style="color: #a3be8c;"> is used.
</span></span></span><span style="display: flex;"><span><span style="color: #a3be8c;">
</span></span></span><span style="display: flex;"><span><span style="color: #a3be8c;">Disable all </span><span style="color: #a3be8c;">`custom-enabled-themes'</span><span style="color: #a3be8c;"> and load the theme in:
</span></span></span><span style="display: flex;"><span><span style="color: #a3be8c;">either </span><span style="color: #a3be8c;">`timu-ui-custom-light-theme'</span><span style="color: #a3be8c;"> or </span><span style="color: #a3be8c;">`timu-ui-custom-dark-theme'</span><span style="color: #a3be8c;">."</span>
</span></span><span style="display: flex;"><span>     <span style="color: #eceff4;">(</span><span style="color: #81a1c1;">if</span> <span style="color: #eceff4;">(</span><span style="color: #88c0d0;">boundp</span> <span style="color: #a3be8c;">'ns-system-appearance-change-functions</span><span style="color: #eceff4;">)</span>
</span></span><span style="display: flex;"><span>         <span style="color: #616e87; font-style: italic;">;; for emacs-plus:</span>
</span></span><span style="display: flex;"><span>         <span style="color: #eceff4;">(</span><span style="color: #81a1c1;">progn</span>
</span></span><span style="display: flex;"><span>           <span style="color: #eceff4;">(</span><span style="color: #81a1c1;">pcase</span> appearance
</span></span><span style="display: flex;"><span>             <span style="color: #eceff4;">(</span><span style="color: #a3be8c;">'light</span> <span style="color: #eceff4;">(</span><span style="color: #81a1c1;">progn</span> <span style="color: #eceff4;">(</span>customize-set-variable <span style="color: #a3be8c;">'timu-spacegrey-flavour</span> <span style="color: #a3be8c;">"light"</span><span style="color: #eceff4;">)</span>
</span></span><span style="display: flex;"><span>                            <span style="color: #eceff4;">(</span><span style="color: #88c0d0;">mapc</span> <span style="color: #88c0d0;">#'</span>disable-theme custom-enabled-themes<span style="color: #eceff4;">)</span>
</span></span><span style="display: flex;"><span>                            <span style="color: #eceff4;">(</span>load-theme timu-ui-custom-light-theme <span style="color: #8fbcbb;">t</span><span style="color: #eceff4;">)))</span>
</span></span><span style="display: flex;"><span>             <span style="color: #eceff4;">(</span><span style="color: #a3be8c;">'dark</span> <span style="color: #eceff4;">(</span><span style="color: #81a1c1;">progn</span> <span style="color: #eceff4;">(</span>customize-set-variable <span style="color: #a3be8c;">'timu-spacegrey-flavour</span> <span style="color: #a3be8c;">"dark"</span><span style="color: #eceff4;">)</span>
</span></span><span style="display: flex;"><span>                           <span style="color: #eceff4;">(</span><span style="color: #88c0d0;">mapc</span> <span style="color: #88c0d0;">#'</span>disable-theme custom-enabled-themes<span style="color: #eceff4;">)</span>
</span></span><span style="display: flex;"><span>                           <span style="color: #eceff4;">(</span>load-theme timu-ui-custom-dark-theme <span style="color: #8fbcbb;">t</span><span style="color: #eceff4;">)))))</span>
</span></span><span style="display: flex;"><span>       <span style="color: #616e87; font-style: italic;">;; for emacsmacport:</span>
</span></span><span style="display: flex;"><span>       <span style="color: #eceff4;">(</span><span style="color: #81a1c1;">let</span> <span style="color: #eceff4;">((</span>mac-mode <span style="color: #eceff4;">(</span><span style="color: #88c0d0;">plist-get</span> <span style="color: #eceff4;">(</span>mac-application-state<span style="color: #eceff4;">)</span> <span style="color: #81a1c1;">:appearance</span><span style="color: #eceff4;">)))</span>
</span></span><span style="display: flex;"><span>         <span style="color: #eceff4;">(</span><span style="color: #81a1c1;">cond</span> <span style="color: #eceff4;">((</span><span style="color: #88c0d0;">equal</span> mac-mode <span style="color: #a3be8c;">"NSAppearanceNameAqua"</span><span style="color: #eceff4;">)</span>
</span></span><span style="display: flex;"><span>                <span style="color: #eceff4;">(</span><span style="color: #81a1c1;">progn</span> <span style="color: #eceff4;">(</span>customize-set-variable <span style="color: #a3be8c;">'timu-spacegrey-flavour</span> <span style="color: #a3be8c;">"light"</span><span style="color: #eceff4;">)</span>
</span></span><span style="display: flex;"><span>                       <span style="color: #eceff4;">(</span><span style="color: #88c0d0;">mapc</span> <span style="color: #88c0d0;">#'</span>disable-theme custom-enabled-themes<span style="color: #eceff4;">)</span>
</span></span><span style="display: flex;"><span>                       <span style="color: #eceff4;">(</span>load-theme timu-ui-custom-light-theme <span style="color: #8fbcbb;">t</span><span style="color: #eceff4;">)))</span>
</span></span><span style="display: flex;"><span>               <span style="color: #eceff4;">((</span><span style="color: #88c0d0;">equal</span> mac-mode <span style="color: #a3be8c;">"NSAppearanceNameDarkAqua"</span><span style="color: #eceff4;">)</span>
</span></span><span style="display: flex;"><span>                <span style="color: #eceff4;">(</span><span style="color: #81a1c1;">progn</span> <span style="color: #eceff4;">(</span>customize-set-variable <span style="color: #a3be8c;">'timu-spacegrey-flavour</span> <span style="color: #a3be8c;">"dark"</span><span style="color: #eceff4;">)</span>
</span></span><span style="display: flex;"><span>                       <span style="color: #eceff4;">(</span><span style="color: #88c0d0;">mapc</span> <span style="color: #88c0d0;">#'</span>disable-theme custom-enabled-themes<span style="color: #eceff4;">)</span>
</span></span><span style="display: flex;"><span>                       <span style="color: #eceff4;">(</span>load-theme timu-ui-custom-dark-theme <span style="color: #8fbcbb;">t</span><span style="color: #eceff4;">)))))))</span>
</span></span></code></pre></div><h4 id="timu-ui-load-theme-hook">timu-ui-load-theme-hook</h4>
<p>Well this runs the aforementioned hook function.</p>
<div class="highlight"><pre tabindex="0"><code class="language-emacs-lisp"><span style="display: flex;"><span><span style="color: #eceff4;">(</span><span style="color: #81a1c1;">defun</span> timu-ui-load-theme-hook <span style="color: #eceff4;">()</span>
</span></span><span style="display: flex;"><span>     <span style="color: #a3be8c;">"Function to add </span><span style="color: #a3be8c;">`timu-ui-theme-hook'</span><span style="color: #a3be8c;"> as a hook.
</span></span></span><span style="display: flex;"><span><span style="color: #a3be8c;">Change theme with </span><span style="color: #a3be8c;">`ns-system-appearance-change-functions'</span><span style="color: #a3be8c;"> for emacs-plus.
</span></span></span><span style="display: flex;"><span><span style="color: #a3be8c;">Or change theme with </span><span style="color: #a3be8c;">`mac-effective-appearance-change-hook'</span><span style="color: #a3be8c;"> for emacsmacport."</span>
</span></span><span style="display: flex;"><span>     <span style="color: #eceff4;">(</span><span style="color: #81a1c1;">if</span> <span style="color: #eceff4;">(</span><span style="color: #88c0d0;">boundp</span> <span style="color: #a3be8c;">'ns-system-appearance-change-functions</span><span style="color: #eceff4;">)</span>
</span></span><span style="display: flex;"><span>         <span style="color: #eceff4;">(</span>add-to-list <span style="color: #a3be8c;">'ns-system-appearance-change-functions</span> <span style="color: #a3be8c;">'timu-ui-theme-hook</span><span style="color: #eceff4;">)</span>
</span></span><span style="display: flex;"><span>       <span style="color: #eceff4;">(</span><span style="color: #81a1c1;">progn</span>
</span></span><span style="display: flex;"><span>         <span style="color: #eceff4;">(</span>add-hook <span style="color: #a3be8c;">'mac-effective-appearance-change-hook</span> <span style="color: #88c0d0;">#'</span>timu-ui-theme-hook<span style="color: #eceff4;">)</span>
</span></span><span style="display: flex;"><span>         <span style="color: #eceff4;">(</span>add-hook <span style="color: #a3be8c;">'after-init-hook</span> <span style="color: #88c0d0;">#'</span>timu-ui-theme-hook<span style="color: #eceff4;">))))</span>
</span></span></code></pre></div><p><strong>ET VOILÀ.</strong></p>