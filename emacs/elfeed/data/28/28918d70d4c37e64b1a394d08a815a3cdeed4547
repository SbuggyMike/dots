<!-- SC_OFF --><div class="md"><p>May I go over how to install <a href="https://github.com/Foxboron/sbctl#readme">sbctl</a>, <a href="https://wiki.archlinux.org/title/Dracut">dracut</a>, <a href="https://wiki.archlinux.org/title/Systemd-boot">systemd-boot</a> and <a href="https://aur.archlinux.org/packages/dracut-uefi-hook">dracut-uefi-hook (aur)</a>? May I also assume that you have already generated the keys and configured <strong>secureboot</strong> with sbctl?</p> <p>My recommended additional configrations are:</p> <p>For <strong>systemd-boot</strong> in <code>/boot/loader/loader.conf</code>:</p> <pre><code># https://www.freedesktop.org/software/systemd/man/loader.conf.html :&#39; CONSOLE-MODE 0 Standard UEFI 80x25 mode 1 80x50 mode, not supported by all devices 2 the first non-standard mode provided by the device firmware, if any auto Pick a suitable mode automatically using heuristics max Pick the highest-numbered available mode keep Keep the mode selected by firmware (the default)&#39; console-mode auto timeout 10 # editor yes # init =/bin/bash auto-entries 1 auto-firmware 1 # default #random-seed-mode [off, with-system-token, always] #run &#39;bootctl random-seed&#39; to initialize both in ESP and system token inside EFI random-seed-mode with-system-token </code></pre> <p>For <strong>dracut</strong> in <code>/etc/dracut.conf.d/50-secure-boot.conf</code>:</p> <pre><code># /etc/dracut.conf.d/50-secure-boot.conf uefi_secureboot_cert=&quot;/usr/share/secureboot/keys/db/db.pem&quot; uefi_secureboot_key=&quot;/usr/share/secureboot/keys/db/db.key&quot; uefi_splash_image=&quot;/usr/share/systemd/bootctl/splash-arch.bmp&quot; </code></pre> <p>For the <strong>kernel options</strong> in <code>/etc/kernel/cmdline</code> <em>(just en example, use your options)</em>:</p> <pre><code># /etc/kernel/cmdline initrd=\amd-ucode.img initrd=\initramfs-linux.img systemd.unit=graphical.target root=LABEL=ARCHLINUX_ROOT resume=LABEL=SWAP rw amd_iommu=off iommu=pt nowatchdog </code></pre> <p>For the <strong>dracut-uefi-hook</strong> in <code>/etc/dracut-uefi-hook.conf</code>:</p> <pre><code># /etc/dracut-uefi-hook.conf # Configuration file for dracut-uefi-hook package # Kernel package to be set as default in systemd-boot # eg. setting this to &#39;linux&#39; is equivalent of calling # &#39;bootctl set-default ENTRY_ID_FOR_LINUX&#39; after # each upgrade of corresponding package # default_kernel_package=&#39;linux-zen&#39; # Hook /etc/os-release before each invocation of # dracut to generate pretty names for entries hook_for_pretty_name=true </code></pre> <p>Now, for each kernel you update or install, signed efi stubs will be (re)created. In case you uninstall a kernel, corresponding efi stubs will be deleted. And your systemd-boot picks it all automatically - you need no loader entries.</p> <p><strong>You&#39;ll never have to touch a boat menu or clean up your ESP again. It&#39;s all streamlined and fully automated.</strong></p> </div><!-- SC_ON --> &#32; submitted by &#32; <a href="https://www.reddit.com/user/Moo-Crumpus"> /u/Moo-Crumpus </a> <br/> <span><a href="https://www.reddit.com/r/archlinux/comments/w3o6vf/sbctl_systemdboot_dracut_and_efistubs/">[link]</a></span> &#32; <span><a href="https://www.reddit.com/r/archlinux/comments/w3o6vf/sbctl_systemdboot_dracut_and_efistubs/">[comments]</a></span>