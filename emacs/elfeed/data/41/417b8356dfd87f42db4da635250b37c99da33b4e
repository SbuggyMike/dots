<!-- SC_OFF --><div class="md"><p>Hi all, I&#39;m trying to setup hibernation with an encrypted swap partition. I&#39;m hitting this error:</p> <pre><code>$ systemctl hibernate Failed to hibernate system via logind: Not enough swap space for hibernation </code></pre> <p>From what I understand, my swap partition (6th partition on an nvme lvm) is decrypting and is recognized by the device mapper. At 17G, the swap should be more than enough to hibernate my 16G system, especially near idle.</p> <p>I&#39;m not sure what I&#39;m doing wrong at this point, and would appreciate a pointer. System and config info follows. Thanks!</p> <p>Devices:</p> <pre><code>$ blkid [SWAP --&gt;] /dev/mapper/swap: LABEL=&quot;swap&quot; UUID=&quot;f25a9fb2-f32d-4b75-b302-d19b0de7f16b&quot; TYPE=&quot;swap&quot; /dev/nvme0n1p5: UUID=&quot;f5b2be9b-c12e-4476-ba04-34691054d7c2&quot; TYPE=&quot;crypto_LUKS&quot; PARTUUID=&quot;a4ac6471-19cc-5b4c-a566-647502c9d115&quot; /dev/nvme0n1p3: UUID=&quot;4b82b7f8-a25e-46cf-a2c0-05074dd0746b&quot; TYPE=&quot;crypto_LUKS&quot; PARTUUID=&quot;fe717a3b-d84d-db4e-a8ba-e3feb8b78855&quot; /dev/nvme0n1p1: LABEL_FATBOOT=&quot;NO_LABEL&quot; LABEL=&quot;NO_LABEL&quot; UUID=&quot;77C2-DC07&quot; BLOCK_SIZE=&quot;512&quot; TYPE=&quot;vfat&quot; PARTUUID=&quot;5bc5cb9a-b3b6-764a-8efe-191132e5d858&quot; [SWAP --&gt;] /dev/nvme0n1p6: UUID=&quot;e1c127ae-b586-48b9-804d-b38af53b7731&quot; TYPE=&quot;crypto_LUKS&quot; PARTUUID=&quot;fa7dc054-a2e3-4cd0-977a-239ccf498211&quot; /dev/nvme0n1p4: UUID=&quot;7d6ca532-7f21-4ade-9b08-304c67d2e359&quot; TYPE=&quot;crypto_LUKS&quot; PARTUUID=&quot;70d336fc-9d0e-824d-a856-b6c436199738&quot; /dev/nvme0n1p2: UUID=&quot;8b6dff69-c5e9-4ba2-898f-a9cfb425bc16&quot; TYPE=&quot;crypto_LUKS&quot; PARTUUID=&quot;2acd9304-fd64-1641-97d0-8e00390a2cb2&quot; /dev/mapper/ainstvarloop: UUID=&quot;7e86e41d-66e4-4c44-bd88-43b708bf596f&quot; BLOCK_SIZE=&quot;4096&quot; TYPE=&quot;ext4&quot; /dev/mapper/ainsthomeloop: UUID=&quot;052bd468-cd19-4e5c-ac89-da13fa122a24&quot; BLOCK_SIZE=&quot;4096&quot; TYPE=&quot;ext4&quot; /dev/mapper/cryptlvm: UUID=&quot;ca05afb5-5b78-432c-9cdd-c895e769a069&quot; BLOCK_SIZE=&quot;4096&quot; TYPE=&quot;ext4&quot; /dev/sda1: UUID=&quot;f689fd1a-7026-4810-a3d9-82b8af39b185&quot; TYPE=&quot;crypto_LUKS&quot; PARTUUID=&quot;dcce6762-01&quot; /dev/mapper/ainstoptloop: UUID=&quot;36f7056c-440a-419b-8338-0c4761899266&quot; BLOCK_SIZE=&quot;4096&quot; TYPE=&quot;ext4&quot; $ swapon NAME TYPE SIZE USED PRIO /dev/dm-1 partition 17G 0B -2 $ ll /dev/mapper/swap lrwxrwxrwx root root 7 B Thu Jul 21 15:22:46 2022  /dev/mapper/swap@ ⇒ ../dm-1 </code></pre> <p>Configs:</p> <pre><code>$ cat /etc/fstab # &lt;file system&gt; &lt;dir&gt; &lt;type&gt; &lt;options&gt; &lt;dump&gt; &lt;pass&gt; # /dev/mapper/ainstloop UUID=ca05afb5-5b78-432c-9cdd-c895e769a069 / ext4 rw,relatime 0 1 # /dev/nvme0n1p1 LABEL=NO_LABEL UUID=77C2-DC07 /boot vfat rw,relatime,fmask=0022,dmask=0022,codepage=437,iocharset=ascii,shortname=mixed,utf8,errors=remount-r0 2 # /dev/mapper/ainsthomeloop UUID=052bd468-cd19-4e5c-ac89-da13fa122a24 /home ext4 rw,relatime 0 2 # /dev/mapper/ainstoptloop UUID=36f7056c-440a-419b-8338-0c4761899266 /opt ext4 rw,relatime 0 2 # /dev/mapper/ainstvarloop UUID=7e86e41d-66e4-4c44-bd88-43b708bf596f /var ext4 rw,relatime 0 2 # /dev/mapper/swap UUID=f25a9fb2-f32d-4b75-b302-d19b0de7f16b none swap defaults,nofail 0 0 $ cat /etc/crypttab ainstvarloop UUID=4b82b7f8-a25e-46cf-a2c0-05074dd0746b /etc/cryptsetup-keys.d/varloop.key luks,key-slot=1 ainstoptloop UUID=7d6ca532-7f21-4ade-9b08-304c67d2e359 /etc/cryptsetup-keys.d/optloop.key luks,key-slot=1 ainsthomeloop UUID=f5b2be9b-c12e-4476-ba04-34691054d7c2 /etc/cryptsetup-keys.d/homeloop.key luks,key-slot=1 swap UUID=e1c127ae-b586-48b9-804d-b38af53b7731 /etc/cryptsetup-keys.d/swap.key swap,luks,key-slot=1,nofail $ cat /etc/mkinitcpio.conf MODULES=() BINARIES=() FILES=() HOOKS=(base udev autodetect keyboard keymap modconf block encrypt filesystems resume fsck) $ head /etc/default/grub # GRUB boot loader configuration #GRUB_DEFAULT=0 GRUB_DEFAULT=saved GRUB_TIMEOUT=5 GRUB_DISTRIBUTOR=&quot;Arch&quot; GRUB_CMDLINE_LINUX_DEFAULT=&quot;loglevel=3 quiet resume=UUID=e1c127ae-b586-48b9-804d-b38af53b7731 systemd.zram=0&quot; GRUB_CMDLINE_LINUX=&quot;cryptdevice=UUID=8b6dff69-c5e9-4ba2-898f-a9cfb425bc16:cryptlvm rootfstype=ext4&quot; </code></pre> <p>Edits to the grub and mkinitcpio were followed up by <code>grub-mkconfig -o /boot/grub/grub.cfg</code> and <code>mkinitcpio -P</code>.</p> <p>In the grub config, I wasn&#39;t sure what device identifier to feed into <code>resume=</code>. Using the UUID for the decrypted volume gave me a device not found error, so I used the UUID for the partition itself. The error may be here, but I&#39;m not sure.</p> </div><!-- SC_ON --> &#32; submitted by &#32; <a href="https://www.reddit.com/user/LionSuneater"> /u/LionSuneater </a> <br/> <span><a href="https://www.reddit.com/r/archlinux/comments/w4uovu/hibernation_fail_on_a_luks_encrypted_swap/">[link]</a></span> &#32; <span><a href="https://www.reddit.com/r/archlinux/comments/w4uovu/hibernation_fail_on_a_luks_encrypted_swap/">[comments]</a></span>